<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Have No Eyes And I Must Stream</title>
    <link rel="stylesheet" href="resource/css/style.css">
    <script>
        var MUSIC_AUDIO = new Audio();
        MUSIC_AUDIO.loop = "loop";

        // Initialize music volume from localStorage or set default
        const savedMusicVolume = localStorage.getItem("music_volume");
        if (savedMusicVolume) {
            MUSIC_AUDIO.volume = parseFloat(savedMusicVolume);
        } else {
            MUSIC_AUDIO.volume = 0.5; // default
            localStorage.setItem("music_volume", "0.5");
        }

        MUSIC_AUDIO.src = "resource/Loyalty Freak Music - TO CHILL AND STAY AWAKE - 02 Everyone.mp3";

        function startMusic() {
            MUSIC_AUDIO.play().catch(function (error) {
                setTimeout(startMusic, 100);
            });
        }
        startMusic();

        // Update music volume from localStorage every 300ms
        setInterval(function () {
            const savedMusicVolume = localStorage.getItem("music_volume");
            if (savedMusicVolume) {
                const volume = parseFloat(savedMusicVolume);
                if (MUSIC_AUDIO.volume !== volume) {
                    MUSIC_AUDIO.volume = volume;
                }
            }
        }, 300);

        function playSFX(soundFile) {
            // Create new audio element each time and set volume from localStorage
            const audio = new Audio(soundFile);
            const sfxVolume = localStorage.getItem('sfx_volume');
            audio.volume = sfxVolume ? parseFloat(sfxVolume) : 0.7; // default to 0.7 if not set

            // Play the sound
            audio.play().catch(function (error) {
                console.warn('SFX playback failed:', error);
            });
        }

        // Parse custom streamers from URL parameter 'for'
        const urlParams = new URLSearchParams(window.location.search);
        const forParam = urlParams.get('for');
        let customStreamers = [];
        if (forParam) {
            customStreamers = forParam.split(',').map(s => s.trim()).filter(s => s);
        }
        window.customStreamers = customStreamers;
    </script>
    <script type="module">
        import './resource/js/common.js';
        import './resource/js/twitch.js';
        import './resource/js/twitch_irc.js';
    </script>
</head>

<body style="margin: 0; padding: 0; overflow:hidden">
    <iframe src="page/menu.html" frameborder="0" style="width: 100%; height: 100vh; border: none;"></iframe>
</body>

</html>